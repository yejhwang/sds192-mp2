---
title: "Mini-Project 2"
author: "Lisa Chen and Yejin Hwang"
date: "October 31, 2017"
output: html_document
---

```{r,eval=FALSE}
## Loading the data
load("house_elections.rda")
load("candidates.rda")
load("committees.rda")
load("contributions.rda")
```

```{r, include=FALSE}
library(dplyr)
library(tidyverse)
library(ggplot2)
```

```{r, eval=FALSE}
# selected columns for smaller dataframes and saved
candidate_info <- candidates %>%
  select(cand_id, cand_name, cand_party_affiliation, cand_election_yr, cand_office)

save(candidate_info,file="candidate_info.rda")
glimpse(candidate_info)

committee_info <- committees %>%
  select(cmte_id, org_type, cand_id)

save(committee_info,file="committee_info.rda")
glimpse(committee_info)

contribution_info <- contributions %>%
  select(cmte_id,transaction_amt,cand_id)

save(contribution_info,file="contribution_info.rda")
glimpse(contribution_info)
```

```{r}
load("candidate_info.rda")
load("committee_info.rda")
load("contribution_info.rda")

#Because inner_join was done specifically to cand_id and not to other_id (FEC ID of the recipient committee or the supported or opposed candidate ID), the data is limited to candidates receiving money from the filing committee directly.
join_two <- contribution_info %>%
  inner_join(candidate_info, by = c("cand_id"="cand_id"))

joined_three <- join_two %>%
  inner_join(committee_info, by = c("cmte_id"="cmte_id"))

joined_three <- joined_three %>%
  filter(cand_party_affiliation == "DEM" | cand_party_affiliation == "REP") %>%
  filter(cand_election_yr >=2009 & cand_election_yr <=2013)
```

```{r}
joined_threes <- joined_three %>%
  group_by(cand_office, org_type, cand_party_affiliation) %>%
    summarize(trans_amt = sum(transaction_amt))
#divide joined three to two data sets
#1 - with org_types
w_org <- joined_threes %>%
  filter(org_type != "") %>%
  mutate(org_type = case_when(
  "C" ~ "Corporation",
  "L" ~ "Labor organization",
  "M" ~ "Membership organization",
  "T" ~ "Trade association",
  "V" ~ "Cooperative",
  "W" ~ "Corporation without capital stock",
  TRUE ~ var)
  )
#2 - observations that don't have org_types
w_o_org <- joined_threes %>%
  filter(org_type == "")

```

```{r}
FilL <- c("#232066", "#E91D0E")
by_office_bar <- function(dtfrm){
  ggplot(data = dtfrm, aes(x = org_type, y=trans_amt, fill = cand_party_affiliation, color = cand_party_affiliation)) +
    geom_bar(position="dodge", stat="identity") +
    scale_fill_manual(values=FilL) +
    facet_wrap(cand_office)
}

#****because of summarize, object cand_office not found

w_org_plot <- by_office_bar(w_org)
w_org_plot
#by_office_bar(w_o_org)
org_dtfrmes <- list(w_org, w_o_org)
lapply(org_dtfrmes, FUN = by_office_bar)
```




