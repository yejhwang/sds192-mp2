---
title: "Mini-Project 2"
author: "Lisa Chen and Yejin Hwang"
date: "October 31, 2017"
output: html_document
---

```{r,eval=FALSE}
## Loading the data
load("house_elections.rda")
load("candidates.rda")
load("committees.rda")
load("contributions.rda")
```

```{r, include=FALSE}
library(dplyr)
library(tidyverse)
library(ggplot2)
```

```{r, eval=FALSE}
# selected columns for smaller dataframes and saved
candidate_info <- candidates %>%
  select(cand_id, cand_name, cand_party_affiliation, cand_election_yr, cand_office)

save(candidate_info,file="candidate_info.rda")
glimpse(candidate_info)

committee_info <- committees %>%
  select(cmte_id, org_type, cand_id)

save(committee_info,file="committee_info.rda")
glimpse(committee_info)

contribution_info <- contributions %>%
  select(cmte_id,transaction_amt,cand_id)

save(contribution_info,file="contribution_info.rda")
glimpse(contribution_info)
```

```{r}
load("candidate_info.rda")
load("committee_info.rda")
load("contribution_info.rda")

#Because inner_join was done specifically to cand_id and not to other_id (FEC ID of the recipient committee or the supported or opposed candidate ID), the data is limited to candidates receiving money from the filing committee directly.
join_two <- contribution_info %>%
  inner_join(candidate_info, by = c("cand_id"="cand_id"))

joined_three <- join_two %>%
  inner_join(committee_info, by = c("cmte_id"="cmte_id"))

joined_three <- joined_three %>%
  filter(cand_party_affiliation == "DEM" | cand_party_affiliation == "REP") %>%
  filter(cand_election_yr >=2009 & cand_election_yr <=2013)
```

```{r}
joined_threes <- joined_three %>%
  group_by(cand_office, org_type, cand_party_affiliation) %>%
    summarize(trans_amt = sum(transaction_amt))

#divide joined three to two data sets
#1 - with org_types
w_org <- joined_threes %>%
  filter(org_type != "") 
#2 - observations that don't have org_types
w_o_org <- joined_threes %>%
  filter(org_type == "")

```

```{r}
#rename office labels for facet_wrap
var_to_string <- as_labeller(c(
  'H' = "House",
  'S'="Senate",
  "P" = "Presidential"
))

```


```{r}
FilL <- c("#232066", "#E91D0E")
by_office_bar <- function(dtfrm,bool){
  ggplot(data = dtfrm, aes(x = org_type, y=trans_amt, fill = cand_party_affiliation)) +
    geom_bar(width=0.8, position = position_dodge(width=0.5), stat="identity") +
    scale_fill_manual(values=FilL) +
    facet_wrap(~cand_office,labeller=var_to_string, nrow = ifelse(bool, 3, 0)) 
}
```
```{r,fig.height=14, fig.width=14}
plot_A <- by_office_bar(w_org, TRUE) +
  scale_x_discrete(labels = c("Corporation","Labor org.","Membership \n   org.","Trade \n assoc.","Co-op","Corporation w/o \n capital stock")) +
  coord_flip()
plot_A
```
```{r}
plot_B <- by_office_bar(w_o_org, FALSE) +
  theme(axis.ticks.x =element_blank())
plot_B

```




